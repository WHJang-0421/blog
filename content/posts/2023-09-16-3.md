---
title:  "인터프리터 3: 절차형 언어"
author: "Woohyuk Jang"
draft: false

date: "2023-09-16"
description: ""
categories:
  - cs/compilers
tags:
  - Blog
---
### 인터프리터 #3: 절차형 언어



이 블로그 포스트는 [Crafting Interpreters](https://craftinginterpreters.com/)를 읽은 후 정리한 글이다. 구현은 [여기](https://github.com/WHJang-0421/make-interpreters)에 했으며 책의 코드를 그대로 따라했다.



저번에 만든 계산기(expression evaluator)에다가 statements, control flow(if, for, while), functions를 추가하면 C와 같은 절차형 언어를 위한 인터프리터가 완성된다.



1. Statements



* scanner와 parser는 이전과 별 다를게 없다.

* interpreter 구현을 위해서는 enviornment(환경)의 개념이 필요하다. variable declaration은 environment에 새로운 변수를 추가하고, assignment는 environment에서 변수를 바꾼다.

* assignment에서 l-value와 r-value의 개념도 알게 되었다. l-value를 ‘evaluate’하면 할당할 수 있는 환경 상의 변수명이 나오고, r-value를 evaluate하면 실제 값이 나온다.



Lexical Scope의 구현도 알게 되었다.



* lexical scope는 static scope라고도 부르며, 코드를 실행하지 않아도 변수가 어떤 scope에 있는지 알 수 있는 것이다.

* environment가 자신의 부모 environment에 대한 레퍼런스를 가지게 하여 연결리스트 형태로 관리하면 구현할 수 있다.



2\. Control flow



* if와 while문의 구현은 별거 없다.

* control flow를 구현할 때 and와 or을 구현해야 하는데, 이때 이들은 short-circuit이라는 점만 유의하면 된다.

* for 문은 while문과 사실 같다. (syntactic sugar) 그래서 AST를 만들 때 새 노드를 만들 필요가 없고 그냥 이미 존재하는 while문을 이용하면 된다. (desugaring)



3\. Functions



* 호출 (function call) 구현



a) callee는 Callable로 evaluate되는 expression이다. (이름이 아니어도 된다. `getCallback()()` 를 생각해보라)



b) 호출할 때 그 호출만의 환경을 만들어주고, argument를 넣는다.



* native functions: 유저에게 제공되는 함수 중 host language (그러니까 lox가 아니라 java)로 구현된 함수다.

* 함수 정의: 파싱까지는 별거 없다. lox에서 함수는 first-class citizen (일급 객체)이므로, 변수처럼 저장한다. (물론 LoxFunction 인터페이스를 상속받게 해주어야 한다)

* 반환 (return): return이 일어나면 AST를 쭉 올라와서 함수 호출된 부분까지 올라와야 한다. 그래서 오류처리를 이용했다.



4\. 클로져 (Closures)



* 원래 클로져 개념을 제대로 이해 못 했는데 이 책을 통해 이제 알게 되었다.

* 클로져는 정의될 당시의 주변 환경을 붙잡고 있는 함수이다.



```

fun makeCounter() {

  var i = 0;

  fun count() {

    i = i + 1;

    print i;

  }

  return count;

}



var counter = makeCounter();

counter(); // "1".

counter(); // "2".

```



* 클로져를 구현할 때 shadowing 때문에 오류가 생길 수 있다. 이를 해결하기 위해 Semantic Analysis의 일종인 Resolving을 한다. Resolving은 변수가 어떤 환경의 어떤 변수를 가리키는지를 명확히 결정하는 작업이다.



By [Woohyuk Jang](https://medium.com/@morrranii) on [September 16, 2023](https://medium.com/p/bd13bb77a202).

Exported from [Medium](https://medium.com) on August 26, 2025.
